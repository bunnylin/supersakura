// Runaway City
// Main menu and game definitions

sys.settitle "Runaway City"
$s1 := "Hiroaki"

// 480x296 view in 640x400 frame @ 80,16
viewport.setparams viewport:1 parent:0, ratiox = 16, ratioy = 10
viewport.setparams viewport:2 parent:1, locx 0 locy 0 sizex 32768 sizey 32768
viewport.setdefault 2 // all game graphics will go in viewport 2

viewport.setbkgindex viewport:1 index 0
viewport.setbkgindex viewport:2 index 1

#gfx.show MEIF bkg viewport 1


// Textbox setup
tbox.setnumboxes 5
choice.setpartbox 3
choice.setchoicebox 3
choice.sethighlightbox 4
choice.columns 1

// 1: Game text box
tbox.setparam 1 minrows 4
tbox.setparam 1 maxrows 4
tbox.setparam 1 minsizex 23000
tbox.setparam 1 maxsizex 23000
tbox.setparam 1 ax 16384
tbox.setparam 1 ay 32768
tbox.setparam 1 lx 16384
tbox.setparam 1 ly 32000
tbox.setparam 1 margintop 640

tbox.setparam 1 basecolor 0x000B
tbox.setparam 1 basefill 0

tbox.settexture 1 RUNBOX2
tbox.setparam 1 texleftedge 10
tbox.setparam 1 texrightedge 48
tbox.setparam 1 textopedge 46
tbox.setparam 1 texbottomedge 16
tbox.setparam 1 bevel 0
tbox.setparam 1 autowaitkey 1

// 2: Dialogue title box
tbox.setparam 2 minrows 1
tbox.setparam 2 maxrows 1
tbox.setparam 2 mincols 8
tbox.setparam 2 lx 4800
tbox.setparam 2 ly 25000
tbox.setparam 2 margintop 256
tbox.setparam 2 marginbottom 256
tbox.setparam 2 marginleft 512
tbox.setparam 2 marginright 512
tbox.setparam 2 snaptobox 1

tbox.setparam 2 textcolor 0xFFFF
tbox.setparam 2 basecolor0 0x000D
tbox.setparam 2 basecolor1 0x220C
tbox.setparam 2 basecolor2 0x110B
tbox.setparam 2 basecolor3 0x330A
tbox.setparam 2 bevel 1

// 3: Choice box
tbox.setparam 3 maxrows 10
tbox.setparam 3 mincols 6
tbox.setparam 3 lx 640
tbox.setparam 3 ly 18000
tbox.setparam 3 ay 6400
tbox.setparam 3 margintop 512
tbox.setparam 3 marginbottom 512

tbox.setparam 3 textcolor 0xFFFF
tbox.setparam 3 basecolor 0x000F
tbox.setparam 3 basefill 0
tbox.settexture 3 RUNBOX type stretched
tbox.setparam 3 texleftedge 14
tbox.setparam 3 texrightedge 14
tbox.setparam 3 textopedge 14
tbox.setparam 3 texbottomedge 13
tbox.setparam 3 bevel 0

// 4: Highlight box
tbox.setparam 4 marginleft 320
tbox.setparam 4 marginright 320
tbox.setparam 4 margintop 80
tbox.setparam 4 marginbottom 80
tbox.setparam 4 bevel 1
tbox.setparam 4 basecolor 0xFFF7


// Framed game text box, plain white text without decorations
// 512x64 pixels at 64,328
#style.reset 5
#style.set 5: basetype 0; bkgcolor = 0, 0, 0, 0; textcolor = FFFFFFFF
#style.set 5: loc = 3600, 26980; size = 25564 x 5210; fontheight = 1300
#style.set 5: margins = 0, 0, 0, 0; transition 0 noshadow 1

// Framed title box, completely invisible
#style.copy 6, 1
#style.set 6: basetype 0; bkgcolor = 0, 0, 0, 0; textcolor = 0


// ===== Opening Animation =====
// skip the animation if it's already been shown once?

// ===== Title Screen =====
gfx.show OP_013 bkg
gfx.transition 15
sleep
gfx.show OP_013A0 anim

gfx.show TCHOICE1
gfx.show TCHOICE2
gfx.show TCHOICE3
gfx.show TCHOICE4
gfx.setframe TCHOICE2; 4
gfx.transition 0 // instantly transitioned in
#fx.gobslidealpha TCHOICE1; 0; 0 // instantly fully transparent
#fx.gobslidealpha TCHOICE2; 0; 0
#fx.gobslidealpha TCHOICE3; 0; 0
#fx.gobslidealpha TCHOICE4; 0; 0
// fade choices to full visibility one at a time
#fx.gobslidealpha TCHOICE1; 255; 500
sleep 100
#fx.gobslidealpha TCHOICE2; 255; 500
sleep 100
#fx.gobslidealpha TCHOICE3; 255; 500
sleep 100
#fx.gobslidealpha TCHOICE4; 255; 500
sleep


// ===== Main Menu =====
waitkey
goto ngclick

@mainmenu:
event.clear
// clickable areas in 948x592 resolution:
// 380,426; 570,462
// 374,466; 570,500
// 410,504; 538,546
// 434,547; 512,582
#event.create NEWGAME; area; 13135,23580, 19702,25572 ; ngclick
#event.mouseon NEWGAME; ngon
#event.mouseoff NEWGAME; ngoff
//event.create LOADGAME; area; 12927,25794, 19702,27676 ; lgclick
//event.mouseon LOADGAME; lgon
//event.mouseoff LOADGAME; lgoff
#event.create GALLERY; area; 14172,27897, 18596,30222 ; galclick
#event.mouseon GALLERY; galon
#event.mouseoff GALLERY; galoff
#event.create QUITGAME; area; 15001,30277, 17697,32214 ; qgclick
#event.mouseon QUITGAME; qgon
#event.mouseoff QUITGAME; qgoff
#waitevent

@ngon:
gfx.setsequence TCHOICE1; 1
fiber.stop
@ngoff:
gfx.setsequence TCHOICE1; 4
fiber.stop
@galon:
gfx.setsequence TCHOICE3; 1
fiber.stop
@galoff:
gfx.setsequence TCHOICE3; 4
fiber.stop
@qgon:
gfx.setsequence TCHOICE4; 1
fiber.stop
@qgoff:
gfx.setsequence TCHOICE4; 4
fiber.stop

@galclick:
return

// ===== New Game =====
@ngclick:
event.clear
gfx.clearall

#gfx.show MEIF bkg viewport 1

call MT_0101.

// ===== Quit Game =====
@qgclick:
sys.quit
